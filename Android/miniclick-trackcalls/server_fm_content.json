{"status":true,"content":"<?php\n\/* ===============================\n   AI FILE MANAGER \u2013 ROOT LEVEL\n   NO AUTH \/ NO TOKEN\n   =============================== *\/\n\/* ===== CONFIG ===== *\/\n$BASE_PATH = realpath(__DIR__);\n$SECRET_TOKEN = \"567898765678\"; \/\/ Same as MySQL manager for consistency\n\/* ===== HEADERS ===== *\/\nheader(\"Content-Type: application\/json; charset=utf-8\");\nheader(\"Access-Control-Allow-Origin: *\");\nheader(\"Access-Control-Allow-Methods: GET, POST, OPTIONS\");\nheader(\"Access-Control-Allow-Headers: Content-Type, Authorization\");\nif ($_SERVER['REQUEST_METHOD'] === 'OPTIONS') {\n    http_response_code(200);\n    exit;\n}\n\/* ===== AI META DESCRIPTION ===== *\/\n\/**\n * AI AGENT TOOL: FILE MANAGER\n * URL: [This Script URL]\n * AUTH: Bearer 567898765678\n * BODY: { \"action\": \"list|read|create_file|update_file|delete_file|create_folder|delete_folder|rename|move|help\", ... }\n *\/\n\/* ===== AUTH CHECK ===== *\/\n$auth = $_SERVER['HTTP_AUTHORIZATION'] ?? '';\nif (!preg_match('\/Bearer\\s(.+)\/', $auth, $m) || $m[1] !== $SECRET_TOKEN) {\n    http_response_code(401);\n    echo json_encode([\"status\" => false, \"message\" => \"Unauthorized\"]);\n    exit;\n}\n\/* ===== HELPERS ===== *\/\nfunction safePath($path)\n{\n    global $BASE_PATH;\n    $path = trim($path, \"\/\");\n    $full = $BASE_PATH . '\/' . $path;\n    $real = realpath($full) ?: $full;\n    if (strpos(realpath(dirname($real)), $BASE_PATH) !== 0) {\n        echo json_encode([\n            \"status\" => false,\n            \"message\" => \"Invalid path access\"\n        ]);\n        exit;\n    }\n    return $real;\n}\nfunction deleteFolder($dir)\n{\n    if (!is_dir($dir)) return;\n    foreach (scandir($dir) as $item) {\n        if ($item === '.' || $item === '..') continue;\n        $path = $dir . '\/' . $item;\n        is_dir($path) ? deleteFolder($path) : unlink($path);\n    }\n    rmdir($dir);\n}\n\/* ===== INPUT ===== *\/\n$data = json_decode(file_get_contents(\"php:\/\/input\"), true) ?? [];\n$action = $data['action'] ?? '';\n\/* ===== ACTION HANDLER ===== *\/\nswitch ($action) {\n    case \"help\":\n        echo json_encode([\n            \"status\" => true,\n            \"description\" => \"AI File Manager API\",\n            \"usage\" => \"POST JSON to this URL\",\n            \"actions\" => [\n                \"list\" => [\"path\" => \"relative path\"],\n                \"read\" => [\"path\" => \"file path\"],\n                \"create_file\" => [\"path\" => \"path\", \"content\" => \"text\"],\n                \"update_file\" => [\"path\" => \"path\", \"content\" => \"text\"],\n                \"delete_file\" => [\"path\" => \"path\"],\n                \"create_folder\" => [\"path\" => \"path\"],\n                \"delete_folder\" => [\"path\" => \"path\"],\n                \"rename\" => [\"old_path\" => \"path\", \"new_path\" => \"path\"],\n                \"move\" => [\"old_path\" => \"path\", \"new_path\" => \"path\"]\n            ]\n        ]);\n        break;\n    case \"list\":\n        $path = safePath($data['path'] ?? '');\n        $files = [];\n        if (!is_dir($path)) {\n            echo json_encode([\"status\" => false, \"message\" => \"Folder not found: \" . ($data['path'] ?? 'root')]);\n            exit;\n        }\n        foreach (scandir($path) as $f) {\n            if ($f === '.' || $f === '..') continue;\n            \n            $fullPath = \"$path\/$f\";\n            $isDir = is_dir($fullPath);\n            \n            $files[] = [\n                \"name\" => $f,\n                \"type\" => $isDir ? \"folder\" : \"file\",\n                \"size\" => $isDir ? 0 : filesize($fullPath),\n                \"mtime\" => filemtime($fullPath),\n                \"permissions\" => substr(sprintf('%o', fileperms($fullPath)), -4)\n            ];\n        }\n        echo json_encode([\"status\" => true, \"data\" => $files, \"current_directory\" => $path]);\n        break;\n    case \"read\":\n        $file = safePath($data['path'] ?? '');\n        echo json_encode([\n            \"status\" => true,\n            \"content\" => file_exists($file) ? file_get_contents($file) : \"\"\n        ]);\n        break;\n    case \"create_file\":\n        $file = safePath($data['path'] ?? '');\n        file_put_contents($file, $data['content'] ?? '');\n        echo json_encode([\"status\" => true, \"message\" => \"File created\"]);\n        break;\n    case \"update_file\":\n        $file = safePath($data['path'] ?? '');\n        file_put_contents($file, $data['content'] ?? '');\n        echo json_encode([\"status\" => true, \"message\" => \"File updated\"]);\n        break;\n    case \"delete_file\":\n        $file = safePath($data['path'] ?? '');\n        if (file_exists($file)) unlink($file);\n        echo json_encode([\"status\" => true, \"message\" => \"File deleted\"]);\n        break;\n    case \"create_folder\":\n        $folder = safePath($data['path'] ?? '');\n        if (!is_dir($folder)) mkdir($folder, 0777, true);\n        echo json_encode([\"status\" => true, \"message\" => \"Folder created\"]);\n        break;\n    case \"delete_folder\":\n        $folder = safePath($data['path'] ?? '');\n        deleteFolder($folder);\n        echo json_encode([\"status\" => true, \"message\" => \"Folder deleted\"]);\n        break;\n    case \"rename\":\n    case \"move\":\n        $old = safePath($data['old_path'] ?? '');\n        $new = safePath($data['new_path'] ?? '');\n        if (rename($old, $new)) {\n            echo json_encode([\"status\" => true, \"message\" => \"Success\"]);\n        } else {\n            echo json_encode([\"status\" => false, \"message\" => \"Failed to move\/rename\"]);\n        }\n        break;\n    default:\n        echo json_encode([\n            \"status\" => false,\n            \"message\" => \"Invalid action\"\n        ]);\n}"}